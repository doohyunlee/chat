<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
	<script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
	<script	src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>
</head>
<body>

<div class="j-message">

</div>
<div class="j-footer">

    <table>
        <tr>
            <td width="100%">
		<input id="my_id" class="form-control" type="text">	
                <input id="message-input" class="form-control" type="text">
            </td>
            <td width="20%">
                <button id="message-button" class="btn btn-default" type="submit">SEND</button>
            </td>
        </tr>
    </table>

</div>


<script type="text/javascript" src="http://cdn.socket.io/socket.io-1.4.0.js"></script>

<script>

    var serverURL = '13.124.67.79:50000';
    var name = 'guest';

  //  var name = $('#my_id').val();
    var room = '100';

    var socket = null;

    function writeMessage(type, name, message) {
        var html = '<div>{MESSAGE}</div>';
        var printName = '';
		/*
        if(type === 'me') {
            printName = name + ' : ';
        }
		*/


		printName = name + ' : ';
        html = html.replace('{MESSAGE}', printName + message);

        $(html).appendTo('.j-message');
        $('body').stop();
        $('body').animate({scrollTop:$('body').height()}, 500);

    }

    function sender(text,name) {
        socket.emit('user', {
            name : name,
            message : text
        });

        writeMessage('me', name, text);
    }

    $(document).ready(function() {

	//name = $('#my_id').val();

	console.log('name :', name);

        socket = io.connect(serverURL);

        socket.on('connection', function(data) {
            console.log('here come');

            if(data.type === 'connected') {


			console.log("name -- ", name);

                socket.emit('connection', {
                    type : 'join',
                    name : name,
                    room : room
                });
            }
        });

        socket.on('system', function(data) {
            writeMessage('system', 'system', data.message);
        });

        socket.on('message', function(data) {
            writeMessage('other', data.name, data.message);
        });

        $('#message-button').click(function() {

            var $input = $('#message-input');
	        name = $('#my_id').val();	
            var msg = $input.val();
            sender(msg,name);
            $input.val('');
            $input.focus();

        });

        $('#message-input').on('keypress', function(e) {

            if(e.keyCode === 13) {

                var $input = $('#message-input');
				name = $('#my_id').val();

                var msg = $input.val();
                sender(msg, name);
                $input.val('');
                $input.focus();
            }
        });

    });

</script>
</body>
</html>



